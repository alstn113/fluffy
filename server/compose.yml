x-app: &app
  image: ${DOCKER_APP_IMAGE}
  env_file:
    - .env
  environment:
    TZ: Asia/Seoul
    SPRING_PROFILES_ACTIVE: prod
  restart: always
  depends_on:
    - redis

services:
  redis:
    container_name: redis
    image: redis:7.4.1
    restart: always
    ports:
      - '6379:6379'
  app-blue:
    <<: *app
    container_name: app-blue
    ports:
      - '8080:8080'
      - '8082:8082'
  app-green:
    <<: *app
    container_name: app-green
    ports:
      - '8081:8080'
      - '8083:8082'
